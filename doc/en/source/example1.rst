*****************************************
Define and trigger a fog function
*****************************************

Define a "hello world" fog function 
-----------------------------------------------

create a fog function from the FogFlow editor 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

annotate its input 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

provide the code of your own function
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    
    .. code-block:: javascript
    
        exports.handler = function(contextEntity, publish, query, subscribe) {
            console.log("enter into the user-defined fog function");
        
            if (contextEntity == null) {
                return;
            }
            if (contextEntity.attributes == null) {
                return;
            }
        
            var updateEntity = {};
            updateEntity.entityId = {
                id: "Stream.result.001",
                type: 'result',
                isPattern: false
            };
            updateEntity.attributes = {};
            updateEntity.attributes.city = {
                type: 'string',
                value: 'Heidelberg'
            };
        
            updateEntity.metadata = {};
            updateEntity.metadata.location = {
                type: 'point',
                value: {
                    'latitude': 33.0,
                    'longitude': -1.0
                }
            };
        
            publish(updateEntity);
            console.log("publish: ", updateEntity);
        
        };

submit your fog function
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    


Trigger your "hello world" fog function 
--------------------------------------------

The defined "hello world" fog function is triggered only when its required input data are available. 
With the following command, you can create a "temperature" entity to trigger the function. 

.. code-block:: console 

    curl -iX POST \
      'http://localhost:8080/ngsi10/updateContext' \
      -H 'Content-Type: application/json' \
      -d '
    {
        "contextElements": [
            {
                "entityId": {
                    "id": "001",
                    "type": "temperature",
                    "isPattern": false
                },
                "attributes": [
                {
                  "name": "temp",
                  "type": "integer",
                  "contextValue": 10
                }
                ],
                "domainMetadata": [
                {
                    "name": "location",
                    "type": "point",
                    "value": {
                        "latitude": 49.406393,
                        "longitude": 8.684208
                    }
                }
                ]
            }
        ],
        "updateAction": "UPDATE"
    }'

You can check whether the fog function is triggered or not in the following way. 

- check the task instance of this fog function


- check the result generated by its running task instance

    .. code-block:: console 
   
        curl -X GET 'http://localhost:8080/ngsi10/entities' 




